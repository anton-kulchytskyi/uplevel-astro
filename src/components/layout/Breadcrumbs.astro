---
import linksData from '@/data/links.json';

const base = import.meta.env.BASE_URL;

const currentPath = Astro.url.pathname;
const cleanPath = currentPath.replace(base, '').replace(/\/+$/, '') || '/';

const allLinks = [...linksData.main, ...linksData.services];

function findPageInfo(url: string) {
  return allLinks.find((link) => link.url === url);
}

const getUrl = (url: string) => {
  if (!url) return null;
  if (url === '/') return base;
  return `${base}/${url.startsWith('/') ? url.slice(1) : url}`;
};

const breadcrumbs = [];
breadcrumbs.push({ title: 'Home', url: '/' });

const pathSegments = cleanPath.split('/').filter((s) => s);

if (pathSegments[0] === 'services' && pathSegments.length > 1) {
  breadcrumbs.push({ title: 'Our Services', url: '/services' });
}

if (cleanPath !== '/') {
  const currentPage = findPageInfo(cleanPath);
  if (currentPage) {
    breadcrumbs.push({ title: currentPage.title, url: null });
  }
}
---

{
  breadcrumbs.length > 1 && (
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol class="breadcrumbs-list">
        {breadcrumbs.map((crumb, index) => {
          const isLast = index === breadcrumbs.length - 1;

          return (
            <li class="breadcrumbs-item">
              {!isLast && crumb.url ? (
                <>
                  <a href={getUrl(crumb.url)}>{crumb.title}</a>
                  <span class="breadcrumbs-separator">â€º</span>
                </>
              ) : (
                <span class="current">{crumb.title}</span>
              )}
            </li>
          );
        })}
      </ol>
    </nav>
  )
}

<style>
  .breadcrumbs {
    margin: 2rem var(--spacing) 0;
  }

  .breadcrumbs-list {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
    flex-wrap: wrap;
  }

  .breadcrumbs-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
  }

  .breadcrumbs-item a {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .breadcrumbs-item a:hover {
    color: var(--color-white);
    text-decoration: underline;
  }

  .breadcrumbs-item .current {
    color: var(--color-white);
    font-weight: 500;
  }

  .breadcrumbs-separator {
    color: rgba(255, 255, 255, 0.4);
    user-select: none;
  }

  @media (max-width: 768px) {
    .breadcrumbs {
      padding: 0.75rem 0;
    }

    .breadcrumbs-item {
      font-size: 0.85rem;
    }
  }
</style>
